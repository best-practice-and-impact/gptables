language: python


python:
  - 3.6
  - 3.7
  - 3.8
  
install:
  - pip install -r requirements.txt
script:
  - python -m unittest discover -p 'test_*.py'


jobs:
  include:
    - stage: "Pandas 1.0.0 Test"
      python: 3.8
      install:
        - pip install -r requirements.txt
        - pip install pandas==1.0.0
      script:
        - python -m unittest discover -p 'test_*.py'
    - stage: "Documentation"
      install:
        - pip install .[docs]
      script:
        - (cd docs && make html)
      deploy:
        provider: pages
        skip_cleanup: true
        github_token: $GITHUB_TOKEN  # Set in travis-ci.com dashboard
        keep-history: true
        on:
          branch: master
        local_dir: ./docs/build/html/
    - stage: "Test PyPI deployment"
      script: skip
      deploy:
        provider: pypi
        server: https://test.pypi.org/legacy/
        user: "__token__"
        password: $TESTPYPI_TOKEN  # Set in travis-ci.com dashboard
        skip_existing: true
        on:
          branch: dev
          type: pull_request
    - stage: "Deploy to PyPI"
      script: skip
      deploy:
        provider: pypi
        user: "__token__"
        password: $PYPI_TOKEN  # Set in travis-ci.com dashboard
        skip_existing: true  # Don't deploy if version not incremented
        on:
          branch: master
